{# templates/group/show.html.twig #}
{% extends 'base.html.twig' %}

{% block title %}ðŸŽ¬
	{{ group.name }}
{% endblock %}

{% block body %}
	<div class="container mt-4">
		<div class="d-flex justify-content-between align-items-center mb-4">
			<h1 class="mb-0">ðŸŽ¬
				{{ group.name }}</h1>
			<a href="{{ path('user_dashboard') }}" class="btn btn-outline-secondary btn-sm">Volver</a>
		</div>

		<ul class="nav nav-tabs border-bottom-0" id="groupTab" role="tablist">
			<li class="nav-item">
				<button class="nav-link active" id="cartelera-tab" data-bs-toggle="tab" data-bs-target="#cartelera" type="button" role="tab">
					<i class="bi bi-film me-2"></i>Cartelera
				</button>
			</li>
			<li class="nav-item">
				<button class="nav-link" id="miembros-tab" data-bs-toggle="tab" data-bs-target="#miembros" type="button" role="tab">
					<i class="bi bi-people me-2"></i>Miembros
				</button>
			</li>
			<li class="nav-item">
				<button class="nav-link" id="ajustes-tab" data-bs-toggle="tab" data-bs-target="#ajustes" type="button" role="tab">
					<i class="bi bi-gear me-2"></i>Ajustes
				</button>
			</li>
		</ul>

		<div class="tab-content bg-white p-4 shadow-sm rounded-bottom border" id="groupTabContent">

			<div class="tab-pane fade show active" id="cartelera" role="tabpanel">
				<div class="row row-cols-2 row-cols-md-4 g-3">
					{% for rec in recommendations %}
						<div class="col text-center">
							{% if rec.movie.posterPath %}
								<img src="https://image.tmdb.org/t/p/w500{{ rec.movie.posterPath }}" class="img-fluid rounded shadow-sm mb-2">
							{% endif %}
							<p class="small fw-bold mb-0 text-truncate">{{ rec.movie.title }}</p>
							<small class="text-muted d-block">Por:
								{{ rec.recommendedBy.name|default(rec.recommendedBy.email) }}</small>
						</div>
					{% else %}
						<div class="col-12 text-center py-5">
							<p class="text-muted">AÃºn no hay pelÃ­culas recomendadas.</p>
						</div>
					{% endfor %}
				</div>
			</div>

			{# PESTAÃ‘A MIEMBROS en group/show.html.twig #}
			<div class="tab-pane fade" id="miembros" role="tabpanel">

				{% if app.user.id == group.owner.id %}
					<div class="card border-0 bg-primary-subtle mb-4 shadow-sm">
						<div class="card-body p-3">
							<div class="d-flex align-items-center justify-content-between">
								<div class="d-flex align-items-center gap-3">
									<div class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
										<i class="bi bi-megaphone-fill"></i>
									</div>
									<div>
										<h6 class="mb-0 fw-bold text-primary-emphasis">Â¡Crece tu comunidad!</h6>
										<p class="small mb-0 d-none d-md-block text-primary-emphasis opacity-75">
											Invita a otros amigos para compartir recomendaciones.
										</p>
									</div>
								</div>

								<button class="btn btn-primary rounded-pill d-flex align-items-center gap-2 px-3 px-md-4" data-bs-toggle="modal" data-bs-target="#addMemberModal">
									<i class="bi bi-person-plus-fill"></i>
									<span class="d-none d-md-inline fw-bold">AÃ±adir miembro</span>
								</button>
							</div>
						</div>
					</div>
				{% endif %}

				<div class="d-flex align-items-center gap-2 mb-3 px-1">
					<i class="bi bi-people-fill text-secondary"></i>
					<span class="fw-bold small text-uppercase tracking-wider text-secondary">
						Miembros del club â€”
						{{ group.members|length }}
					</span>
				</div>

				<div class="list-group list-group-flush shadow-sm rounded-3 border overflow-hidden">
					{% for groupMember in group.members %}
						<div class="list-group-item d-flex align-items-center justify-content-between py-3">
							<div class="d-flex align-items-center gap-3 overflow-hidden">
								<i class="bi bi-person-circle fs-3 text-secondary-subtle"></i>
								<div class="text-truncate">
									<span class="fw-bold d-block text-truncate" style="font-size: 0.9rem;">
										{{ groupMember.user.name|default(groupMember.user.email) }}
									</span>
									{% if groupMember.role == 'OWNER' %}
										<span class="badge bg-warning-subtle text-warning-emphasis p-0" style="font-size: 0.7rem;">
											<i class="bi bi-star-fill"></i>
											FUNDADOR
										</span>
									{% endif %}
								</div>
							</div>

							<div class="d-none d-sm-block text-end me-3">
								<small class="text-muted small d-block">{{ groupMember.user.email }}</small>
							</div>
						</div>
					{% endfor %}
				</div>
			</div>

			<div class="tab-pane fade" id="ajustes" role="tabpanel">
				<div class="row">
					<div class="col-md-6 border-end">
						<h6>InformaciÃ³n General</h6>
						<p class="small text-muted">{{ group.description|default('Sin descripciÃ³n.') }}</p>
						<button class="btn btn-sm btn-outline-primary">Editar Nombre / DescripciÃ³n</button>
					</div>
					<div class="col-md-6 ps-md-4">
						<h6 class="text-danger">Zona de peligro</h6>
						<p class="small text-muted">Si abandonas el club, perderÃ¡s acceso a esta cartelera.</p>

						{# BotÃ³n que activa un modal de confirmaciÃ³n #}
						<button class="btn btn-sm btn-danger" data-bs-toggle="modal" data-bs-target="#leaveModal">
							Darse de baja del club
						</button>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div class="modal fade" id="leaveModal" tabindex="-1" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">Â¿Abandonar club?</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					Â¿EstÃ¡s seguro de que quieres dejar
					<strong>{{ group.name }}</strong>? PodrÃ¡s volver a unirte si el club es pÃºblico o te invitan.
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
					{# <form action="{{ path('app_group_leave', {id: group.id}) }}" method="POST">
																									                    <button type="submit" class="btn btn-danger">Confirmar baja</button>
																									                </form> #}
				</div>
			</div>
		</div>
	</div>

{% endblock %}
