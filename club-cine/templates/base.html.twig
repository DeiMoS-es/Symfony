<!DOCTYPE html>
<html lang="es">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
		<title>
			{% block title %}ClubCine
			{% endblock %}
		</title>

		<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 128 128%22><text y=%221.2em%22 font-size=%2296%22>ðŸŽ¬</text></svg>">

		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

		<style>
			body {
				display: flex;
				flex-direction: column;
				min-height: 100vh;
				background-color: #f8f9fa;
			}
			main {
				flex: 1;
			}
		</style>

		{% block stylesheets %}{% endblock %}

		{% block javascripts %}
			{% block importmap %}
				{{ importmap('app') }}
			{% endblock %}
		{% endblock %}
	</head>
	<body>

		{# INCLUIMOS EL NAVBAR GLOBAL #}
		{% include 'components/_navbar.html.twig' %}

		<main>
			{# CONTENEDOR DE MENSAJES FLASH #}
			<div class="container mt-3">
				<div id="flash-container">
					{% for label, messages in app.flashes %}
						{% for message in messages %}
							<div class="alert alert-{{ label == 'error' or label == 'danger' ? 'danger' : 'success' }} alert-dismissible fade show shadow-sm" role="alert">
								{{ message }}
								<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
							</div>
						{% endfor %}
					{% endfor %}
				</div>
			</div>

			{% block body %}{% endblock %}
		</main>

		{# INCLUIMOS EL FOOTER GLOBAL #}
		{# {% include 'components/_footer.html.twig' %} #}

		{# --- MODAL CREAR GRUPO (Solo si el usuario estÃ¡ logueado y no tiene grupo) --- #}
			{% if app.user and app.user.groups is empty %}
				<div class="modal fade" id="createGroupModal" tabindex="-1" aria-labelledby="createGroupModalLabel" aria-hidden="true"> <div class="modal-dialog modal-dialog-centered">
					<div class="modal-content border-0 shadow-lg">
						<div class="modal-header bg-primary text-white">
							<h5 class="modal-title">ðŸŽ¬ Fundar mi Club de Cine</h5>
							<button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
						</div>
						<div class="modal-body p-4">
							{{ render(controller('App\\Module\\Group\\Controller\\GroupController::new')) }}
						</div>
					</div>
				</div>
			</div>
		{% endif %}
		{# MODAL INFORMATIVO PARA EL FUTURO #}
		{% if app.user and app.user.groups is not empty %}
			<div class="modal fade" id="infoFutureFeatureModal" tabindex="-1" aria-hidden="true">
				<div class="modal-dialog modal-dialog-centered">
					<div class="modal-content border-0 shadow">
						<div class="modal-header bg-info text-white">
							<h5 class="modal-title">
								<i class="bi bi-info-circle me-2"></i>PrÃ³ximamente</h5>
							<button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
						</div>
						<div class="modal-body p-4 text-center">
							<i class="bi bi-rocket-takeoff text-info" style="font-size: 3rem;"></i>
							<h5 class="mt-3 fw-bold">Â¡Un club no es suficiente!</h5>
							<p class="text-muted">
								Actualmente solo permitimos gestionar
								<strong>un club por usuario</strong>
								durante nuestra fase de lanzamiento.
							</p>
							<div class="alert alert-secondary small">
								Estamos trabajando para que muy pronto puedas fundar y gestionar mÃºltiples clubes de cine. Â¡Gracias por tu paciencia!
							</div>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Entendido</button>
						</div>
					</div>
				</div>
			</div>
		{% endif %}

		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

		<script>
			// Auto-cerrar alertas flash despuÃ©s de 5 segundos
			setTimeout(() => {
				document.querySelectorAll('.alert').forEach(alert => {
					const bsAlert = new bootstrap.Alert(alert);
					bsAlert.close();
				});
			}, 8000);
		</script>

	</body>
</html>
